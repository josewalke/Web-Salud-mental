import { useState } from "react";
import { motion } from "motion/react";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "../components/ui/card";
import { Button } from "../components/ui/button";
import { Input } from "../components/ui/input";
import { Textarea } from "../components/ui/textarea";

import { Brain, Heart, Users, CheckCircle, Send, ArrowLeft, Home } from "lucide-react";
import { useNavigate } from "react-router-dom";
import { DynamicBackground } from "../components/DynamicBackground";
import { SEOHead } from "../components/SEOHead";

interface Question {
  id: number;
  text: string;
  type: 'text' | 'textarea' | 'select' | 'radio' | 'checkbox' | 'email';
  options?: string[];
  required: boolean;
}

const questions: Question[] = [
  {
    id: 1,
    text: "¿Cuáles son los tres valores fundamentales que rigen tu vida?",
    type: 'textarea',
    required: true
  },
  {
    id: 2,
    text: "¿Qué importancia le das a la religión o espiritualidad en tu día a día?",
    type: 'select',
    options: ["Muy importante", "Importante", "Poco importante", "No importante", "No aplica"],
    required: true
  },
  {
    id: 3,
    text: "¿Cómo visualizas tu vida dentro de 10 años? (profesión, lugar, estilo de vida)",
    type: 'textarea',
    required: true
  },
  {
    id: 4,
    text: "¿Qué opinas sobre el matrimonio? ¿Es algo esencial para ti?",
    type: 'textarea',
    required: true
  },
  {
    id: 5,
    text: "¿Qué tan importante es para ti tener hijos?",
    type: 'select',
    options: ["Muy importante", "Importante", "Poco importante", "No importante", "No quiero hijos"],
    required: true
  },
  {
    id: 6,
    text: "¿Cómo sueles reaccionar cuando estás muy molesto o herido por alguien cercano?",
    type: 'textarea',
    required: true
  },
  {
    id: 7,
    text: "¿Te resulta fácil hablar sobre tus emociones en una relación?",
    type: 'select',
    options: ["Muy fácil", "Fácil", "Difícil", "Muy difícil", "Depende de la situación"],
    required: true
  },
  {
    id: 8,
    text: "¿Sientes ansiedad o inseguridad cuando tu pareja no está disponible emocionalmente?",
    type: 'select',
    options: ["Siempre", "Frecuentemente", "A veces", "Raramente", "Nunca"],
    required: true
  },
  {
    id: 9,
    text: "¿Cómo actúas cuando hay un conflicto en la relación?",
    type: 'textarea',
    required: true
  },
  {
    id: 10,
    text: "¿Prefieres resolver los problemas en el momento o tomar espacio antes de hablar?",
    type: 'select',
    options: ["En el momento", "Tomar espacio primero", "Depende del problema", "No tengo preferencia"],
    required: true
  },
  {
    id: 11,
    text: "¿Qué tan cómodo te sientes expresando tus necesidades y deseos en una relación?",
    type: 'select',
    options: ["Muy cómodo", "Cómodo", "Poco cómodo", "Muy incómodo", "Depende del tema"],
    required: true
  },
  {
    id: 12,
    text: "¿Cómo manejas las críticas en una relación de pareja?",
    type: 'textarea',
    required: true
  },
  {
    id: 13,
    text: "¿Puedes dar un ejemplo de un conflicto que resolviste exitosamente con una expareja?",
    type: 'textarea',
    required: false
  },
  {
    id: 14,
    text: "¿Qué tan importante es para ti la sinceridad, incluso si duele?",
    type: 'select',
    options: ["Muy importante", "Importante", "Poco importante", "No importante", "Prefiero la diplomacia"],
    required: true
  },
  {
    id: 15,
    text: "¿Tiendes a perdonar fácilmente o a guardar resentimiento?",
    type: 'select',
    options: ["Perdono fácilmente", "Perdono con tiempo", "Guardo algo de resentimiento", "Guardo mucho resentimiento", "Depende de la situación"],
    required: true
  },
  {
    id: 16,
    text: "¿Cómo sería tu pareja ideal?",
    type: 'textarea',
    required: true
  },
  {
    id: 17,
    text: "¿Tienes alguna preferencia con el físico?",
    type: 'textarea',
    required: false
  },
  {
    id: 18,
    text: "¿Cuál es tu correo electrónico?",
    type: 'email',
    required: true
  }
];

export function QuestionnairePage() {
  const [formData, setFormData] = useState<Record<string, string>>({});
  const [currentStep, setCurrentStep] = useState(0);
  const [isSubmitted, setIsSubmitted] = useState(false);
  const navigate = useNavigate();

  // Estilos CSS personalizados para efectos 3D
  const cardStyles = {
    transformStyle: 'preserve-3d' as const,
    perspective: '1000px',
  };

  const handleInputChange = (questionId: string, value: string) => {
    setFormData(prev => ({
      ...prev,
      [questionId]: value
    }));
  };

  const handleNext = () => {
    if (currentStep < questions.length - 1) {
      setCurrentStep(prev => prev + 1);
    }
  };

  const handlePrevious = () => {
    if (currentStep > 0) {
      setCurrentStep(prev => prev - 1);
    }
  };

  const handleSubmit = () => {
    setIsSubmitted(true);
    // Aquí puedes enviar los datos a tu backend
    // console.log('Datos del cuestionario:', formData);
  };

  const renderQuestion = (question: Question) => {
    const value = formData[question.id.toString()] || '';

    switch (question.type) {
      case 'textarea':
        return (
          <Textarea
            value={value}
            onChange={(e) => handleInputChange(question.id.toString(), e.target.value)}
            placeholder="Escribe tu respuesta aquí..."
            className="min-h-[120px] resize-none text-base"
            required={question.required}
          />
        );
      
      case 'select':
        return (
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-3 lg:gap-4">
            {question.options?.map((option, index) => {
              const isLastOption = index === question.options!.length - 1;
              const isOddNumberOfOptions = question.options!.length % 2 === 1;
              const shouldCenterLast = isLastOption && isOddNumberOfOptions;
              
              return (
                <motion.div
                  key={index}
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: index * 0.1 }}
                  className={`relative ${
                    shouldCenterLast 
                      ? 'lg:col-span-2 lg:max-w-md lg:mx-auto' 
                      : ''
                  }`}
                >
                  <label className="flex items-center space-x-4 py-4 px-5 rounded-xl border-2 border-blue-100 hover:border-blue-300 cursor-pointer transition-all duration-300 hover:bg-blue-50/50 hover:shadow-lg group">
                    <input
                      type="radio"
                      name={`question-${question.id}`}
                      value={option}
                      checked={value === option}
                      onChange={(e) => handleInputChange(question.id.toString(), e.target.value)}
                      className="w-5 h-5 text-blue-600 border-2 border-blue-300 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 cursor-pointer flex-shrink-0"
                    />
                    <span className="text-base text-gray-800 group-hover:text-blue-700 transition-colors flex-1 font-medium">
                      {option}
                    </span>
                    {/* Indicador visual de selección */}
                    {value === option && (
                      <motion.div
                        className="w-3 h-3 bg-blue-600 rounded-full flex-shrink-0"
                        initial={{ scale: 0 }}
                        animate={{ scale: 1 }}
                        transition={{ type: "spring", stiffness: 400 }}
                      />
                    )}
                  </label>
                </motion.div>
              );
            })}
          </div>
        );
      
      case 'email':
        return (
          <div className="space-y-3">
            <Input
              type="email"
              value={value}
              onChange={(e) => handleInputChange(question.id.toString(), e.target.value)}
              placeholder="tu@email.com"
              className="h-12 text-base"
              required={question.required}
            />
            <p className="text-sm text-gray-600 italic">
              📧 Te enviaremos los resultados del cuestionario a este correo electrónico
            </p>
          </div>
        );
      
      default:
        return (
          <Input
            type="text"
            value={value}
            onChange={(e) => handleInputChange(question.id.toString(), e.target.value)}
            placeholder="Escribe tu respuesta aquí..."
            className="h-12 text-base"
            required={question.required}
          />
        );
    }
  };

  const progress = ((currentStep + 1) / questions.length) * 100;

  if (isSubmitted) {
    return (
      <div className="min-h-screen relative">
        <DynamicBackground />
        <div className="container mx-auto px-4 py-20 relative z-10">
          <motion.div
            initial={{ opacity: 0, scale: 0.8 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ duration: 0.6 }}
            className="text-center max-w-4xl mx-auto"
          >
            <div className="bg-white/80 backdrop-blur-md rounded-3xl p-12 shadow-2xl shadow-blue-200/30 border border-white/20">
              <CheckCircle className="w-20 h-20 text-green-500 mx-auto mb-6" />
              <h1 className="text-5xl font-bold text-gray-900 mb-6">
                ¡Cuestionario Enviado!
              </h1>
              <p className="text-xl text-gray-600 mb-8">
                Gracias por completar nuestro cuestionario de compatibilidad. 
                Nuestros psicólogos analizarán tus respuestas para encontrar 
                la pareja perfecta para ti.
              </p>
              <div className="bg-gradient-to-r from-blue-50 to-blue-100 rounded-2xl p-8 border border-blue-100/30 mb-8">
                <h3 className="text-2xl font-semibold text-gray-800 mb-4">
                  ¿Qué sigue?
                </h3>
                <ul className="text-left text-gray-600 space-y-3 text-lg">
                  <li className="flex items-center">
                    <div className="w-3 h-3 bg-blue-500 rounded-full mr-4" />
                    Recibirás un análisis personalizado en 24-48 horas
                  </li>
                  <li className="flex items-center">
                    <div className="w-3 h-3 bg-blue-500 rounded-full mr-4" />
                    Te contactaremos para programar una sesión de orientación
                  </li>
                  <li className="flex items-center">
                    <div className="w-3 h-3 bg-green-500 rounded-full mr-4" />
                    Comenzaremos a buscar tu pareja ideal
                  </li>
                </ul>
              </div>
              <Button
                onClick={() => navigate('/')}
                className="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-8 py-4 text-lg font-semibold"
              >
                <Home className="w-5 h-5 mr-2" />
                Volver al Inicio
              </Button>
            </div>
          </motion.div>
        </div>
      </div>
    );
  }

  return (
    <>
      <SEOHead
        title="Cuestionario de Compatibilidad de Pareja | Love on the Brain"
        description="Descubre tu compatibilidad y encuentra a tu pareja ideal con nuestro cuestionario científicamente diseñado por expertos en psicología. Test de compatibilidad gratuito y confidencial."
        keywords={[
          "cuestionario de pareja",
          "test de compatibilidad",
          "encontrar pareja ideal",
          "psicología de parejas",
          "compatibilidad emocional",
          "test psicológico",
          "psicólogos expertos",
          "Love on the Brain",
          "crecimiento personal",
          "relaciones de pareja",
          "compatibilidad amorosa",
          "test de personalidad",
          "psicología del amor",
          "terapia de parejas",
          "evaluación psicológica"
        ]}
        canonicalUrl="https://loveonthebrain.com/cuestionario"
        ogType="website"
        twitterCard="summary_large_image"
      />
      
      <div className="min-h-screen relative">
        <DynamicBackground />
        {/* Header */}
      <motion.header
        className="bg-white/90 backdrop-blur-md shadow-lg border-b border-blue-100 relative z-20"
        initial={{ y: -100 }}
        animate={{ y: 0 }}
        transition={{ duration: 0.6 }}
      >
        <div className="container mx-auto px-4">
          <div className="flex items-center justify-between h-16">
            <Button
              variant="outline"
              onClick={() => navigate('/')}
              className="border-blue-200 text-blue-600 hover:bg-blue-50 hover:border-blue-300 transition-colors"
            >
              <ArrowLeft className="w-4 h-4 mr-2" />
              Volver al Inicio
            </Button>
            
            <div className="flex items-center space-x-4">
              <div className="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-700 rounded-2xl flex items-center justify-center shadow-lg">
                <Heart className="w-7 h-7 text-white" />
              </div>
              <h1 className="text-2xl font-bold text-gray-900">Love on the Brain</h1>
            </div>
          </div>
        </div>
      </motion.header>

      <div className="container mx-auto px-4 py-12 relative z-10">
        {/* Header del Cuestionario */}
        <motion.div
          className="text-center mb-12"
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
        >
          <motion.div
            className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-blue-500 to-blue-700 rounded-full mb-8 shadow-2xl"
            whileHover={{ scale: 1.1, rotate: 5 }}
            transition={{ type: "spring", stiffness: 300 }}
          >
            <Heart className="w-10 h-10 text-white" />
          </motion.div>
          
          <motion.h1
            className="text-4xl lg:text-5xl text-gray-900 mb-6"
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2, duration: 0.8 }}
          >
            Cuestionario de
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-blue-700"> Compatibilidad de Pareja</span>
          </motion.h1>
          
          <motion.p
            className="text-lg text-gray-700 max-w-3xl mx-auto mb-8"
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.4, duration: 0.8 }}
          >
            Descubre tu compatibilidad emocional y encuentra a tu pareja ideal con nuestro 
            <strong>test de compatibilidad científicamente diseñado</strong> por expertos en psicología. 
            Este cuestionario de pareja te ayudará a entender mejor tus necesidades emocionales y 
            encontrar a alguien que realmente te complemente.
          </motion.p>

          {/* Progress bar */}
          <div className="w-full max-w-3xl mx-auto bg-gray-200 rounded-full h-4 mb-6">
            <motion.div
              className="bg-gradient-to-r from-blue-500 to-blue-700 h-4 rounded-full"
              initial={{ width: 0 }}
              animate={{ width: `${progress}%` }}
              transition={{ duration: 0.5 }}
            />
          </div>
          
          <p className="text-xl text-gray-600 font-medium">
            Pregunta {currentStep + 1} de {questions.length}
          </p>
        </motion.div>

        {/* Question Card */}
        <motion.div
          key={currentStep}
          initial={{ opacity: 0, x: 50, rotateY: -15, scale: 0.9 }}
          animate={{ opacity: 1, x: 0, rotateY: 0, scale: 1 }}
          exit={{ opacity: 0, x: -50, rotateY: 15, scale: 0.9 }}
          transition={{ duration: 0.6, ease: "easeOut" }}
          className="max-w-5xl mx-auto"
          style={cardStyles}
        >
          <motion.div
            className="transform-style-preserve-3d"
            whileHover={{ 
              rotateY: 2, 
              rotateX: 1, 
              scale: 1.02,
              z: 20
            }}
            transition={{ 
              type: "spring", 
              stiffness: 300, 
              damping: 20 
            }}
          >
            <Card className="bg-white/90 backdrop-blur-xl shadow-[0_25px_50px_-12px_rgba(59,130,246,0.25),0_0_0_1px_rgba(255,255,255,0.1)] border border-white/30 relative overflow-hidden">
              {/* Efecto de brillo en la parte superior */}
              <div className="absolute inset-0 bg-gradient-to-b from-white/40 via-transparent to-transparent pointer-events-none" />
              
              {/* Borde superior con gradiente */}
              <div className="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600" />
              
              {/* Efecto de sombra interna para profundidad */}
              <div className="absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-black/5 pointer-events-none" />
            <CardHeader className="text-center pb-8">
              <CardTitle className="text-2xl lg:text-3xl text-gray-900 mb-6">
                {questions[currentStep].text}
              </CardTitle>
              {questions[currentStep].required && (
                <CardDescription className="text-red-500 font-medium text-lg">
                  * Esta pregunta es obligatoria
                </CardDescription>
              )}
            </CardHeader>
            
            <CardContent className="space-y-8 px-6">
              <div className="min-h-[150px]">
                {renderQuestion(questions[currentStep])}
              </div>

              {/* Navigation buttons */}
              <div className="flex justify-between items-center pt-8">
                <motion.div
                  whileHover={{ scale: 1.05, y: -2 }}
                  whileTap={{ scale: 0.95 }}
                  transition={{ type: "spring", stiffness: 400 }}
                >
                  <Button
                    onClick={handlePrevious}
                    disabled={currentStep === 0}
                    variant="outline"
                    size="lg"
                    className="px-10 py-4 disabled:opacity-50 border-2 border-blue-200 hover:border-blue-300 shadow-lg hover:shadow-xl transition-all duration-300"
                  >
                    Anterior
                  </Button>
                </motion.div>

                {currentStep === questions.length - 1 ? (
                  <motion.div
                    whileHover={{ scale: 1.05, y: -3 }}
                    whileTap={{ scale: 0.95 }}
                    transition={{ type: "spring", stiffness: 400 }}
                  >
                    <Button
                      onClick={handleSubmit}
                      size="lg"
                      className="bg-gradient-to-r from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800 px-12 py-4 text-lg font-semibold shadow-2xl hover:shadow-[0_20px_25px_-5px_rgba(59,130,246,0.4)] transition-all duration-300 transform hover:-translate-y-1"
                    >
                      <Send className="w-6 h-6 mr-3" />
                      Enviar Cuestionario
                    </Button>
                  </motion.div>
                ) : (
                  <motion.div
                    whileHover={{ scale: 1.05, y: -2 }}
                    whileTap={{ scale: 0.95 }}
                    transition={{ type: "spring", stiffness: 400 }}
                  >
                    <Button
                      onClick={handleNext}
                      size="lg"
                      className="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 px-10 py-4 text-lg font-semibold shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1"
                    >
                      Siguiente
                    </Button>
                  </motion.div>
                )}
              </div>
            </CardContent>
          </Card>
        </motion.div>

        {/* Additional info - SEO optimized */}
        <motion.div
          className="text-center mt-20"
          initial={{ opacity: 0 }}
          whileInView={{ opacity: 1 }}
          viewport={{ once: true }}
          transition={{ delay: 0.6, duration: 0.8 }}
        >
          <div className="bg-white/60 backdrop-blur-md rounded-3xl p-10 border border-white/30 inline-block max-w-4xl shadow-xl">
            <h2 className="text-3xl font-bold text-gray-800 mb-6">
              ¿Por qué elegir nuestro Test de Compatibilidad de Pareja?
            </h2>
            <p className="text-lg text-gray-600 mb-8 max-w-3xl mx-auto">
              Nuestro <strong>cuestionario de compatibilidad</strong> está diseñado por psicólogos expertos 
              para ayudarte a encontrar a tu pareja ideal. Utilizamos metodologías científicas probadas 
              que analizan múltiples dimensiones de la personalidad y las relaciones.
            </p>
            <div className="grid md:grid-cols-3 gap-8 text-left">
              <div className="flex items-start space-x-4">
                <Brain className="w-8 h-8 text-blue-600 mt-1 flex-shrink-0" />
                <div>
                  <h3 className="font-semibold text-gray-800 text-lg mb-2">Científicamente Probado</h3>
                  <p className="text-gray-600">Metodología avalada por psicólogos expertos en relaciones de pareja y compatibilidad emocional</p>
                </div>
              </div>
              <div className="flex items-start space-x-4">
                <Heart className="w-8 h-8 text-blue-600 mt-1 flex-shrink-0" />
                <div>
                  <h3 className="font-semibold text-gray-800 text-lg mb-2">Compatibilidad Real</h3>
                  <p className="text-gray-600">Encuentra a alguien que realmente te entienda, complemente y con quien puedas construir una relación duradera</p>
                </div>
              </div>
              <div className="flex items-start space-x-4">
                <Users className="w-8 h-8 text-green-600 mt-1 flex-shrink-0" />
                <div>
                  <h3 className="font-semibold text-gray-800 text-lg mb-2">Resultados Garantizados</h3>
                  <p className="text-gray-600">Nuestro test de compatibilidad te proporciona resultados precisos o tu dinero de vuelta en 30 días</p>
                </div>
              </div>
            </div>
            
            {/* SEO Content Section */}
            <div className="mt-12 text-left bg-blue-50/50 rounded-2xl p-8 border border-blue-100">
              <h3 className="text-2xl font-semibold text-gray-800 mb-4">
                Test de Compatibilidad de Pareja: ¿Cómo Funciona?
              </h3>
              <div className="grid md:grid-cols-2 gap-6 text-gray-700">
                <div>
                  <h4 className="font-semibold text-gray-800 mb-2">🔍 Análisis Profundo</h4>
                  <p className="text-sm leading-relaxed">
                    Nuestro cuestionario evalúa 18 aspectos clave de tu personalidad, valores y 
                    expectativas en las relaciones. Cada pregunta está diseñada para revelar 
                    patrones de comportamiento y preferencias emocionales.
                  </p>
                </div>
                <div>
                  <h4 className="font-semibold text-gray-800 mb-2">🧠 Base Científica</h4>
                  <p className="text-sm leading-relaxed">
                    Desarrollado por psicólogos expertos en relaciones de pareja, utilizando 
                    metodologías validadas científicamente para garantizar resultados precisos 
                    y confiables.
                  </p>
                </div>
                <div>
                  <h4 className="font-semibold text-gray-800 mb-2">💝 Resultados Personalizados</h4>
                  <p className="text-sm leading-relaxed">
                    Recibe un análisis detallado de tu perfil de compatibilidad, incluyendo 
                    recomendaciones específicas sobre qué buscar en una pareja ideal y 
                    cómo mejorar tus relaciones.
                  </p>
                </div>
                <div>
                  <h4 className="font-semibold text-gray-800 mb-2">🔒 100% Confidencial</h4>
                  <p className="text-sm leading-relaxed">
                    Tu privacidad es nuestra prioridad. Todos los datos del cuestionario 
                    se mantienen completamente confidenciales y seguros.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </motion.div>
      </div>
    </>
  );
}
